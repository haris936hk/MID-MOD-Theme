{% doc %}
  MIN + MOD enhanced navigation structure for curated home marketplace.
  Provides organized navigation by Room, Type, and Style as specified in requirements.

  @param {boolean} [mobile_view] - Whether to render mobile navigation
  @param {string} [current_collection] - Current collection handle for active states

  @example
  {% render 'min-mod-navigation' %}
  {% render 'min-mod-navigation', mobile_view: true %}
{% enddoc %}

{%- assign mobile_view = mobile_view | default: false -%}
{%- assign nav_class = 'min-mod-nav' -%}
{%- if mobile_view -%}
  {%- assign nav_class = nav_class | append: ' min-mod-nav--mobile' -%}
{%- endif -%}

<nav class="{{ nav_class }}" data-min-mod-nav>
  <div class="nav-container">

    <!-- PRODUCTS Main Category -->
    <div class="nav-section nav-section--products">
      <a href="{{ collections.all.url }}" class="nav-section__title">
        {{ 'navigation.products' | t }}
      </a>

      <div class="nav-dropdown" data-nav-dropdown>

        <!-- Shop by Room -->
        <div class="nav-column nav-column--room">
          <h4 class="nav-column__title">{{ 'navigation.shop_by_room' | t }}</h4>
          <ul class="nav-list">
            <li><a href="{{ collections.living.url | default: '/collections/living' }}">{{ 'navigation.rooms.living' | t }}</a></li>
            <li><a href="{{ collections.kitchen.url | default: '/collections/kitchen' }}">{{ 'navigation.rooms.kitchen' | t }}</a></li>
            <li><a href="{{ collections.dining.url | default: '/collections/dining' }}">{{ 'navigation.rooms.dining' | t }}</a></li>
            <li><a href="{{ collections.bedroom.url | default: '/collections/bedroom' }}">{{ 'navigation.rooms.bedroom' | t }}</a></li>
            <li><a href="{{ collections.study.url | default: '/collections/study' }}">{{ 'navigation.rooms.study' | t }}</a></li>
            <li><a href="{{ collections.laundry.url | default: '/collections/laundry' }}">{{ 'navigation.rooms.laundry' | t }}</a></li>
            <li><a href="{{ collections.bathroom.url | default: '/collections/bathroom' }}">{{ 'navigation.rooms.bathroom' | t }}</a></li>
            <li><a href="{{ collections.kids-room.url | default: '/collections/kids-room' }}">{{ 'navigation.rooms.kids_room' | t }}</a></li>
          </ul>
        </div>

        <!-- Shop by Type -->
        <div class="nav-column nav-column--type">
          <h4 class="nav-column__title">{{ 'navigation.shop_by_type' | t }}</h4>
          <ul class="nav-list">
            <li><a href="{{ collections.vases-vessels.url | default: '/collections/vases-vessels' }}">{{ 'navigation.types.vases_vessels' | t }}</a></li>
            <li><a href="{{ collections.sculptures-objects.url | default: '/collections/sculptures-objects' }}">{{ 'navigation.types.sculptures_objects' | t }}</a></li>
            <li><a href="{{ collections.kitchen-tableware.url | default: '/collections/kitchen-tableware' }}">{{ 'navigation.types.kitchen_tableware' | t }}</a></li>
            <li><a href="{{ collections.trays-bowls.url | default: '/collections/trays-bowls' }}">{{ 'navigation.types.trays_bowls' | t }}</a></li>
            <li><a href="{{ collections.cushions-throws.url | default: '/collections/cushions-throws' }}">{{ 'navigation.types.cushions_throws' | t }}</a></li>
            <li><a href="{{ collections.storage-organisation.url | default: '/collections/storage-organisation' }}">{{ 'navigation.types.storage_organisation' | t }}</a></li>
            <li><a href="{{ collections.accessories.url | default: '/collections/accessories' }}">{{ 'navigation.types.accessories' | t }}</a></li>
            <li><a href="{{ collections.plants-florals.url | default: '/collections/plants-florals' }}">{{ 'navigation.types.plants_florals' | t }}</a></li>
          </ul>
        </div>

        <!-- Shop by Material -->
        <div class="nav-column nav-column--material">
          <h4 class="nav-column__title">{{ 'navigation.shop_by_material' | t }}</h4>
          <ul class="nav-list">
            <li><a href="{{ collections.glass-acrylic.url | default: '/collections/glass-acrylic' }}">{{ 'navigation.materials.glass_acrylic' | t }}</a></li>
            <li><a href="{{ collections.marble-stone.url | default: '/collections/marble-stone' }}">{{ 'navigation.materials.marble_stone' | t }}</a></li>
            <li><a href="{{ collections.chrome.url | default: '/collections/chrome' }}">{{ 'navigation.materials.chrome' | t }}</a></li>
            <li><a href="{{ collections.resin-ceramic.url | default: '/collections/resin-ceramic' }}">{{ 'navigation.materials.resin_ceramic' | t }}</a></li>
          </ul>
        </div>

        <!-- Shop by Style -->
        <div class="nav-column nav-column--style">
          <h4 class="nav-column__title">{{ 'navigation.shop_by_style' | t }}</h4>
          <ul class="nav-list">
            <li><a href="{{ collections.modern-contemporary.url | default: '/collections/modern-contemporary' }}">{{ 'navigation.styles.modern_contemporary' | t }}</a></li>
            <li><a href="{{ collections.coastal.url | default: '/collections/coastal' }}">{{ 'navigation.styles.coastal' | t }}</a></li>
            <li><a href="{{ collections.retro.url | default: '/collections/retro' }}">{{ 'navigation.styles.retro' | t }}</a></li>
            <li><a href="{{ collections.wabi-sabi.url | default: '/collections/wabi-sabi' }}">{{ 'navigation.styles.wabi_sabi' | t }}</a></li>
          </ul>
        </div>

      </div>
    </div>

    <!-- ABOUT Link -->
    <div class="nav-section nav-section--single">
      <a href="{{ pages.about.url | default: '/pages/about' }}" class="nav-section__title">
        {{ 'navigation.about' | t }}
      </a>
    </div>

    <!-- CONTACT Link -->
    <div class="nav-section nav-section--single">
      <a href="{{ pages.contact.url | default: '/pages/contact' }}" class="nav-section__title">
        {{ 'navigation.contact' | t }}
      </a>
    </div>

  </div>
</nav>

{% stylesheet %}
  .min-mod-nav {
    background: var(--color-background);
    border-bottom: 1px solid rgba(var(--color-foreground-rgb), 0.1);
    position: relative;
    z-index: 100;
  }

  .nav-container {
    max-width: var(--page-width);
    margin: 0 auto;
    padding: 0 var(--page-margin);
    display: flex;
    align-items: center;
    gap: 3rem;
  }

  .nav-section {
    position: relative;
  }

  .nav-section__title {
    display: block;
    padding: 1.5rem 0;
    text-decoration: none;
    color: var(--color-foreground);
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    font-size: 0.875rem;
    transition: color 0.2s ease;
  }

  .nav-section__title:hover {
    color: var(--color-foreground-heading);
  }

  .nav-section--products:hover .nav-dropdown {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
  }

  .nav-dropdown {
    position: absolute;
    top: 100%;
    left: 0;
    background: var(--color-background);
    border: 1px solid rgba(var(--color-foreground-rgb), 0.1);
    border-radius: var(--border-radius);
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    padding: 2rem;
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 2rem;
    min-width: 800px;
    opacity: 0;
    visibility: hidden;
    transform: translateY(10px);
    transition: all 0.3s ease;
    z-index: 1000;
  }

  .nav-column__title {
    font-size: 0.875rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--color-foreground-heading);
    margin: 0 0 1rem 0;
    border-bottom: 1px solid rgba(var(--color-foreground-rgb), 0.1);
    padding-bottom: 0.5rem;
  }

  .nav-list {
    list-style: none;
    margin: 0;
    padding: 0;
  }

  .nav-list li {
    margin-bottom: 0.75rem;
  }

  .nav-list li:last-child {
    margin-bottom: 0;
  }

  .nav-list a {
    display: block;
    text-decoration: none;
    color: var(--color-foreground);
    font-size: 0.875rem;
    text-transform: lowercase;
    line-height: 1.4;
    transition: color 0.2s ease;
    padding: 0.25rem 0;
  }

  .nav-list a:hover {
    color: var(--color-foreground-heading);
  }

  /* Mobile Navigation */
  .min-mod-nav--mobile {
    display: none;
  }

  @media screen and (max-width: 1024px) {
    .min-mod-nav:not(.min-mod-nav--mobile) {
      display: none;
    }

    .min-mod-nav--mobile {
      display: block;
      background: var(--color-background);
    }

    .min-mod-nav--mobile .nav-container {
      flex-direction: column;
      align-items: stretch;
    }

    .min-mod-nav--mobile .nav-section {
      border-bottom: 1px solid rgba(var(--color-foreground-rgb), 0.1);
    }

    .min-mod-nav--mobile .nav-section__title {
      padding: 1rem 0;
      position: relative;
    }

    .min-mod-nav--mobile .nav-section--products .nav-section__title::after {
      content: '+';
      position: absolute;
      right: 0;
      top: 50%;
      transform: translateY(-50%);
      font-size: 1.25rem;
      transition: transform 0.2s ease;
    }

    .min-mod-nav--mobile .nav-section--products.active .nav-section__title::after {
      transform: translateY(-50%) rotate(45deg);
    }

    .min-mod-nav--mobile .nav-dropdown {
      position: static;
      display: none;
      opacity: 1;
      visibility: visible;
      transform: none;
      grid-template-columns: 1fr;
      min-width: auto;
      box-shadow: none;
      border: none;
      border-radius: 0;
      padding: 0 0 1rem 0;
      background: rgba(var(--color-foreground-rgb), 0.02);
    }

    .min-mod-nav--mobile .nav-section--products.active .nav-dropdown {
      display: grid;
    }

    .min-mod-nav--mobile .nav-column {
      padding: 1rem 0;
      border-bottom: 1px solid rgba(var(--color-foreground-rgb), 0.05);
    }

    .min-mod-nav--mobile .nav-column:last-child {
      border-bottom: none;
    }
  }

  /* Enhanced focus states for accessibility */
  .nav-section__title:focus,
  .nav-list a:focus {
    outline: 2px solid var(--color-foreground);
    outline-offset: 2px;
  }

  /* Animation for dropdown appearance */
  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .nav-dropdown.animate-in {
    animation: fadeInUp 0.3s ease forwards;
  }
{% endstylesheet %}

{% javascript %}
  class MinModNavigation extends HTMLElement {
    constructor() {
      super();
      this.init();
    }

    init() {
      this.isMobile = this.classList.contains('min-mod-nav--mobile');
      this.productSection = this.querySelector('.nav-section--products');
      this.dropdown = this.querySelector('.nav-dropdown');

      if (this.isMobile && this.productSection) {
        this.setupMobileNavigation();
      } else if (this.dropdown) {
        this.setupDesktopNavigation();
      }
    }

    setupMobileNavigation() {
      const title = this.productSection.querySelector('.nav-section__title');

      title.addEventListener('click', (e) => {
        e.preventDefault();
        this.toggleMobileDropdown();
      });
    }

    setupDesktopNavigation() {
      let hoverTimeout;

      this.productSection.addEventListener('mouseenter', () => {
        clearTimeout(hoverTimeout);
        this.showDropdown();
      });

      this.productSection.addEventListener('mouseleave', () => {
        hoverTimeout = setTimeout(() => {
          this.hideDropdown();
        }, 150);
      });

      // Keyboard navigation
      this.productSection.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          this.toggleDropdown();
        } else if (e.key === 'Escape') {
          this.hideDropdown();
        }
      });
    }

    toggleMobileDropdown() {
      this.productSection.classList.toggle('active');
    }

    showDropdown() {
      if (this.dropdown) {
        this.dropdown.classList.add('animate-in');
      }
    }

    hideDropdown() {
      if (this.dropdown) {
        this.dropdown.classList.remove('animate-in');
      }
    }

    toggleDropdown() {
      if (this.dropdown.style.opacity === '1') {
        this.hideDropdown();
      } else {
        this.showDropdown();
      }
    }
  }

  // Register the custom element
  if (!customElements.get('min-mod-navigation')) {
    customElements.define('min-mod-navigation', MinModNavigation);
  }

  // Initialize all navigation instances
  document.addEventListener('DOMContentLoaded', () => {
    const navs = document.querySelectorAll('[data-min-mod-nav]');
    navs.forEach(nav => {
      if (!customElements.get('min-mod-navigation')) return;

      // Convert to custom element if not already
      if (nav.tagName.toLowerCase() !== 'min-mod-navigation') {
        const newNav = document.createElement('min-mod-navigation');
        newNav.innerHTML = nav.innerHTML;
        newNav.className = nav.className;
        nav.parentNode.replaceChild(newNav, nav);
      }
    });
  });
{% endjavascript %}